# Global settings
global:
  port: 8080
  read_timeout: 30s
  write_timeout: 30s
  idle_timeout: 120s

# Health check defaults (can be overridden per service)
health_checks:
  interval: 10s
  timeout: 5s
  unhealthy_threshold: 3  # failures before marking unhealthy
  healthy_threshold: 2    # successes before marking healthy

# Define your backend services
services:
  - name: api
    # Load balancing algorithm: round_robin, least_connections, random, ip_hash, weighted_round_robin
    algorithm: round_robin
    
    # Backends for this service
    backends:
      - url: http://localhost:3001
        weight: 1  # for weighted algorithms
      - url: http://localhost:3002
        weight: 2
      - url: http://localhost:3003
        weight: 1
    
    # Health check (optional, uses global defaults if not specified)
    health_check:
      path: /health
      interval: 5s
      timeout: 3s
    
    # Retry policy
    retry:
      attempts: 3
      backoff: 100ms

  - name: web
    algorithm: least_connections
    backends:
      - url: http://localhost:4001
      - url: http://localhost:4002
    health_check:
      path: /ping

# Routing rules - map incoming requests to services
routes:
  - path: /api/*
    service: api
    strip_prefix: /api  # optional: remove /api before forwarding
    
  - path: /
    service: web
    
  - host: api.example.com
    service: api  # route by hostname

# Optional: circuit breaker settings
circuit_breaker:
  enabled: true
  threshold: 5           # failures before opening circuit
  timeout: 30s          # how long circuit stays open
  half_open_requests: 3 # test requests in half-open state